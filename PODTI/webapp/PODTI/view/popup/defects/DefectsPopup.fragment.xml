<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.ui.layout.form" xmlns:t="sap.ui.table"
    xmlns:core="sap.ui.core"
    xmlns:html="http://www.w3.org/1999/xhtml"
    controllerName="kpmg.custom.pod.PODTI.PODTI.controller.popup.defects.DefectsPopup"
    width="100%"
    height="100%">
    <Dialog title="Defects" showHeader="true" contentHeight="700px"  contentWidth="1500px" verticalScrolling="true" horizontalScrolling="true"> 
        <content>
            <!-- Container principale -->
            <VBox width="100%" height="100%" renderType="Bare" alignItems="Center" justifyContent="Center" fitContainer="true">

                <!-- 1) Filters -->
                <VBox width="95%" height="20%" visible="{/visibleFilters}" renderType="Bare" alignItems="Center" justifyContent="Center" class="headerContainerMainPod containerAddOpts">
                    <HBox width="100%" height="100%" renderType="Bare" alignItems="Center" justifyContent="Center" class="headerContainerMainPod paddingTopTestataSmall">
                        <HBox renderType="Bare" alignItems="Center" width="30%">
                            <Label text="Phase:" width="auto" class="markingHeaderLabel markingSmallLabel sapUiSmallMarginEnd"/>
                            <Select selectedKey="{/filterValue/phase}" width="70%" items="{/filters/phase}" showSecondaryValues="true" change="changeFilter">
                                <core:ListItem key="{phase}" text="{phase}" />
                            </Select>
                        </HBox>
                        <HBox renderType="Bare" alignItems="Center" width="30%">
                            <Label text="Priority:" width="auto" class="markingHeaderLabel markingSmallLabel sapUiSmallMarginEnd"/>
                            <Select  selectedKey="{/filterValue/priority}" width="70%" items="{/filters/priority}" showSecondaryValues="true" change="changeFilter">
                                <core:ListItem key="{priority}" text="{description}" />
                            </Select>
                        </HBox>
                        <HBox renderType="Bare" alignItems="Center" width="30%">
                            <Label text="Status:" width="auto" class="markingHeaderLabel markingSmallLabel sapUiSmallMarginEnd"/>
                            <Select selectedKey="{/filterValue/status}" width="70%" items="{/filters/status}" showSecondaryValues="true" change="changeFilter">
                                <core:ListItem key="{status}" text="{status}" />
                            </Select>
                        </HBox>
                    </HBox>
                </VBox>

                <!-- 2) TreeTable defects -->
                <VBox width="95%" height="78%" renderType="Bare" alignItems="Center" justifyContent="Center" class="mainContainer containerAddOpts">
                    <Toolbar style="Clear">
                        <HBox width="70%" height="100%" renderType="Bare" class="leftButtonsPODOperation"></HBox>       
                        <ToolbarSpacer/> 
                        <Button text="Expand all" press="onExpandAll" icon="sap-icon://expand-group" />
                        <Button text="Collapse all" press="onCollapseAll" icon="sap-icon://collapse-group" />
                    </Toolbar>
                    <t:TreeTable id="treeTableDefectPopup" width="100%" busy="{/BusyLoadingOpTable}" selectionMode="Single" class="kpmgGDTable" rows="{/defects}" enableColumnReordering="true" 
                        enableGrouping="true" selectionBehavior="RowOnly" visibleRowCount="10" rowHeight="45px" >
                        <t:layoutData>
                            <FlexItemData growFactor="1" baseSize="0%"/>
                        </t:layoutData>
                        <t:columns>
                            <t:Column width="18%" hAlign="Left">
                                <Label text="{i18n>defect.treeTable.groupOrCode}"/>
                                <t:template>
                                    <Text text="{groupOrCode}" wrapping="false"/>
                                </t:template>
                            </t:Column>
                            <t:Column width="15%" hAlign="Left">
                                <Label text="{i18n>defect.treeTable.title}"/>
                                <t:template>
                                    <Text text="{title}" wrapping="false"/>
                                </t:template>
                            </t:Column>
                            <t:Column width="12%" hAlign="Center">
                                <Label text="{i18n>defect.treeTable.material}"/>
                                <t:template>
                                    <Text text="{material}" wrapping="false"/>
                                </t:template>
                            </t:Column>
                            <t:Column width="12%" hAlign="Center">
                                <Label text="{i18n>defect.treeTable.priority}"/>
                                <t:template>
                                    <Text text="{priority_description}" wrapping="false"/>
                                </t:template>
                            </t:Column>
                            <t:Column width="12%" hAlign="Center">
                                <Label text="{i18n>defect.treeTable.user}"/>
                                <t:template>
                                    <Text text="{user}" wrapping="false"/>
                                </t:template>
                            </t:Column>  
                            <t:Column width="9%" hAlign="Center">
                                <Label text="{i18n>defect.treeTable.phase}"/>
                                <t:template>
                                    <Text text="{phase}" wrapping="false"/>
                                </t:template>
                            </t:Column>  
                            <t:Column width="12%" hAlign="Center">
                                <Label text="{i18n>defect.treeTable.status}" />
                                <t:template>
                                    <Text text="{status}" wrapping="false"/>
                                </t:template>
                            </t:Column>  
                            <t:Column width="10%" hAlign="Center">
                                <Label text="{i18n>defect.treeTable.qn}"/>
                                <t:template>
                                    <Text text="{qn_code}" wrapping="false"/>
                                </t:template>
                            </t:Column>  
                            <t:Column width="7%" hAlign="Center">
                                <Label text="{i18n>defect.treeTable.close}"/>
                                <t:template>
                                    <Button text="{i18n>defect.treeTable.close}" width="100%" press="onClosePress" visible="{= ${level} === 2 &amp;&amp; ${okClose} }" />
                                </t:template>
                            </t:Column>
                            <t:Column width="8%" hAlign="Center">
                                <Label text="{i18n>defect.treeTable.info}"/>
                                <t:template>
                                    <core:Icon src="sap-icon://hint" color="#d70a32" press="onInfoDefectPress" visible="{= ${level} === 2}" />
                                </t:template>
                            </t:Column>
                        </t:columns>
                    </t:TreeTable>
                </VBox>

            </VBox>
        </content>
        <endButton>
            <Button text="{i18n>defect.button.close}" press="onClosePopup"/>
        </endButton>
    </Dialog>
</core:FragmentDefinition>